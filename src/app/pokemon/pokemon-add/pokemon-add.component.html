<div class="add-container">
  <mat-card>
    <div class="card-wrapper">
      <div class="pokemon-image-container">
        <img
          class="pokemon-image"
          [src]="pokemonPicture.value"
          [alt]="pokemonName.value"
        />
      </div>
      <div class="form-container">
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <div class="form-padding">
            <h2 class="form-title">Ajouter un nouveau Pokémon</h2>
            <table>
              <tbody>
                <tr>
                  <th>Nom</th>
                  <td>
                    <mat-form-field appearance="outline" class="full-width-field">
                      <input
                        matInput
                        type="text"
                        formControlName="name"
                        placeholder="Nom du Pokémon"
                      />
                    </mat-form-field>
                    <!-- Gestion des erreurs Name -->
                    @if(pokemonName.dirty) {
                      @if(pokemonName.hasError('required')) {
                        <div class="invalid-feedback">
                          Veuillez renseigner ce champ.
                        </div>
                      }
                      @if(pokemonName.hasError('minlength')) {
                        <div class="invalid-feedback">
                          Veuillez saisir un nom plus long. (Minimum :
                          {{ pokemonName.getError("minlength").requiredLength }}
                          caractères)
                        </div>
                      }
                      @if(pokemonName.hasError('maxlength')) {
                        <div class="invalid-feedback">
                          Veuillez saisir un nom plus court. (Maximum :
                          {{ pokemonName.getError("maxlength").requiredLength }}
                          caractères)
                        </div>
                      }
                      @if(pokemonName.hasError('pattern')) {
                        <div class="invalid-feedback">
                          Veuillez saisir uniquement des lettres.
                        </div>
                      }
                    }
                  </td>
                </tr>
                <tr>
                  <th>Image</th>
                  <td>
                    <mat-form-field appearance="outline" class="full-width-field">
                      <input
                        matInput
                        type="text"
                        formControlName="picture"
                        placeholder="URL de l'image du Pokémon"
                      />
                    </mat-form-field>
                    @if(pokemonPicture.invalid && pokemonPicture.dirty) {
                      <div class="invalid-feedback">
                        Veuillez renseigner ce champ.
                      </div>
                    }
                  </td>
                </tr>
                <tr>
                  <th>Points de vie</th>
                  <td>
                    <div class="number-row">
                      <button
                        mat-raised-button
                        color="primary"
                        type="button"
                        class="ctrl-btn"
                        [disabled]="pokemonLife.value <= POKEMON_RULES().MIN_LIFE"
                        (click)="decrementLife()"
                      >
                        -
                      </button>
                      <mat-form-field appearance="outline" class="small-number-input">
                        <input
                          matInput
                          type="number"
                          formControlName="life"
                          class="number-input"
                          readonly
                        />
                      </mat-form-field>
                      <button
                        mat-raised-button
                        color="primary"
                        type="button"
                        class="ctrl-btn"
                        [disabled]="pokemonLife.value >= POKEMON_RULES().MAX_LIFE"
                        (click)="incrementLife()"
                      >
                        +
                      </button>
                    </div>
                  </td>
                </tr>
                <tr>
                  <th>Dégâts</th>
                  <td>
                    <div class="number-row">
                      <button
                        mat-raised-button
                        color="primary"
                        type="button"
                        class="ctrl-btn"
                        [disabled]="pokemonDamage.value <= POKEMON_RULES().MIN_DAMAGE"
                        (click)="decrementDamage()"
                      >
                        -
                      </button>
                      <mat-form-field appearance="outline" class="small-number-input">
                        <input
                          matInput
                          type="number"
                          formControlName="damage"
                          class="number-input"
                          readonly
                        />
                      </mat-form-field>
                      <button
                        mat-raised-button
                        color="primary"
                        type="button"
                        class="ctrl-btn"
                        [disabled]="pokemonDamage.value >= POKEMON_RULES().MAX_DAMAGE"
                        (click)="incrementDamage()"
                      >
                        +
                      </button>
                    </div>
                  </td>
                </tr>
                <tr>
                  <th>Types</th>
                  <td>
                    <!-- Affichage des types sélectionnés -->
                    <div class="types-container">
                      @for(type of pokemonTypeList.controls; track type; let index = $index) {
                        <mat-chip
                          color="primary"
                          selected
                          (removed)="pokemonTypeList.removeAt(index)"
                          removable="true"
                          class="type-chip"
                        >
                          {{ type.value }}
                          <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                      }
                    </div>
                    <!-- Gestion des erreurs Types -->
                    @if(pokemonTypeList.hasError('required')) {
                      <p class="invalid-feedback types-error">
                        Veuillez sélectionner au moins un type pour un Pokémon.
                      </p>
                    }
                    @if(pokemonTypeList.hasError('maxlength')) {
                      <p class="invalid-feedback types-error">
                        Veuillez sélectionner au maximum
                        {{ pokemonTypeList.getError("maxlength").requiredLength }}
                        types pour un Pokémon.
                      </p>
                    }
                    <div class="types-checkboxes">
                      @for(type of pokemonService.getPokemonTypeList(); track type) {
                        <mat-checkbox
                          [checked]="isPokemonTypeSelected(type)"
                          (change)="onPokemonTypeChange(type, $event.checked)"
                          color="primary"
                        >
                          {{ type }}
                        </mat-checkbox>
                      }
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="action-buttons">
              <button
                mat-button
                color="primary"
                type="button"
                routerLink="/pokemons"
              >
                ANNULER
              </button>
              <button
                mat-raised-button
                color="accent"
                type="submit"
              >
                SAUVEGARDER LES CHANGEMENTS
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </mat-card>
</div>